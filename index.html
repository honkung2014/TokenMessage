<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="js/connect-fb.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="js/bootstrap-growl.min.js"></script>
	<script language="javascript">
		var FB = new Facebook();
		var tokenList =[];
		function loadaccessToken(){
			var access_token = $("#access_token").val();
			FB.setAccessToken(access_token);
			FB.api("/me",function(res){
				if(res.error){
					$.growl({
						message: 'Access token expire!'
					},{
						type: 'danger',
						mouse_over: "pause",
						placement: {
							from: "top",
							align: "center"
						},
						allow_dismiss: false,
					})
				} else {
					tokenList.push(access_token);
					localStorage.TokenList = JSON.stringify(tokenList);
				}
			});
		}
		function pagemain(){
			if(localStorage.TokenList&&JSON.parse(localStorage.TokenList).length>0){
				tokenList = JSON.parse(localStorage.TokenList);	
				tokenList.forEach(function(q){
					FB.setAccessToken(q);
					FB.api('/me',function(res){
						$("#token_table").append("<tr><td><a href='viewuser.html?token="+res.access_token+"'><img src='https://graph.facebook.com/"+res.id+"/picture' class='img-responsive'></img> "+res.name+"</a></td></tr>");
					});
				});
			} else {
				$(function(){$("#token_table").html("<tr><td colspan='2'>Not have any access token</td></tr>")});
			}
		}
		pagemain();
	</script>
	</head>
<body>

<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="?main"><i class="fa fa-comments-o fa-lg"></i> Token Message<span></a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	</div>
	</div>
 </nav>
<div class="container">
		<div class="col-md-6">
			<form class="form-signin" role="form" action="">
				<h2 class="form-signin-heading">Please sign in with access token.</h2>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-user"></i></span>
						<input type="text" class="form-control" placeholder="Access Token" name="access_token" id="access_token">
					</div>
					<br/>
					<a class="btn btn-lg btn-primary btn-block" type="submit" href="javascript:loadaccessToken()">Sign in</a>
			</form>
		</div>
        <div class="col-md-6">
            <table class="table table-hover col-md-6">
            <thead><th>Avaliable Access token <a id='trashbutton' href="javascript:display_token_delete()"><i class="fa fa-trash"></i></a></th></thead>
			<tbody id="token_table">		
            </tbody>
			</table>
        </div>
</div>

</body>
</html>